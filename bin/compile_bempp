#!/usr/bin/env python2
from __future__ import print_function

import sys
import os
import pexpect

bdir = os.environ['BEMPP_DIR']
barch = os.environ['BEMPP_ARCH']
print("BEMPP_DIR %s" % bdir)
os.chdir(os.path.join(bdir, barch))

fedora_deps = [
]

print('(make sure that the following deps are installed\n'
      'di ' + ' '.join(fedora_deps))

cmakeargs = [
    # '-DBoost_DIR=$HOME/...',
    '-DCMAKE_INSTALL_PREFIX=$HOME/miniconda/envs/$CONDA_DEFAULT_ENV',
    '..']
cmakeargs = list(map(os.path.expandvars, cmakeargs))

print("execute cmake %s in %s?" % (' '.join(cmakeargs), os.getcwd()))

p = pexpect.spawn('cmake', cmakeargs, timeout=None, logfile=sys.stdout)
line = p.readline()
while line:
    line = p.readline()

p = pexpect.spawn('make', ['-j4'], timeout=None, logfile=sys.stdout)
line = p.readline()
while line:
    line = p.readline()

p = pexpect.spawn('make', ['install'], timeout=None, logfile=sys.stdout)
line = p.readline()
while line:
    line = p.readline()
