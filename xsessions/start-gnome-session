#!/bin/dash

MYWM=$1
SHOW_DESKTOP=$2

# Load resources
/usr/bin/xrdb -merge .Xresources

# Set the background color
/usr/bin/xsetroot -solid black
urxvtd -o -q -f &
emacs --daemon

# Update the Gnome configuration to reflect WM and desktop appearance
/usr/bin/gconftool-2 -t string  -s /desktop/gnome/session/required_components/windowmanager ${MYWM}
/usr/bin/gconftool-2 -t boolean -s /apps/nautilus/preferences/show_desktop  ${SHOW_DESKTOP}

if [ "$MYWM" = "awesome" ]; then
	/usr/bin/gconftool-2 -t string  -s /desktop/gnome/session/required_components/panel ""
	/usr/bin/gconftool-2 -s -t list --list-type string /desktop/gnome/session/required_components_list "[filemanager,windowmanager]"
else
	/usr/bin/gconftool-2 -t string  -s /desktop/gnome/session/required_components/panel "gnome-panel"
	/usr/bin/gconftool-2 -s -t list --list-type string /desktop/gnome/session/required_components_list "[filemanager,panel,windowmanager]"
fi


#sleep 2

export WINDOW_MANAGER=/usr/bin/$1

exec /usr/bin/gnome-session
